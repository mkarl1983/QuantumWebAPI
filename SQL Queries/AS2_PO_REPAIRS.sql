SELECT "AGING","ENTRY_DATE","PO_NUMBER","COMPANY_NAME","PN","OPEN_FLAG",
"CORE_SERIAL_NUMBER","CORE_DUE_DATE","CORE_RET_DATE","CORE_CHARGE",
"SM_NUMBER","SHIP_DATE","CONTACT_NUMBER","CONTACT_STATUS","USER_NAME"
FROM (
SELECT
ROUND((SYSDATE)-POH.ENTRY_DATE) AGING,
POH.ENTRY_DATE,
  POH.PO_NUMBER,
  CMP.COMPANY_NAME,
  NVL(PNM.PN,'Linked_to_charge_line') PN,
  POH.OPEN_FLAG,
  EXC.CORE_SERIAL_NUMBER,
  EXC.CORE_DUE_DATE,
  EXC.CORE_RET_DATE,
  EXC.CORE_CHARGE,
  SMH.SM_NUMBER,
  SMH.SHIP_DATE,
  (SELECT MAX( pjh.prj_number) FROM  project_header pjh,
  project_status pjs,
  project_links pjl
WHERE pjh.cmp_auto_key=POH.CMP_AUTO_KEY
and PJL.KEY_VALUE= POD.POD_AUTO_KEY
AND PJH.PJH_AUTO_KEY(+)=PJL.PJH_AUTO_KEY
AND PJS.PJS_AUTO_KEY(+)=PJH.PJS_AUTO_KEY
AND PJH.PJM_AUTO_KEY=63
AND PJS.STATUS_TYPE='O') AS Contact_number,
  
   (SELECT MAX(  pjs.status_code) FROM  project_header pjh,
  project_status pjs,
  project_links pjl
WHERE pjh.cmp_auto_key=POH.CMP_AUTO_KEY
and PJL.KEY_VALUE= POD.POD_AUTO_KEY
AND PJH.PJH_AUTO_KEY(+)=PJL.PJH_AUTO_KEY
AND PJS.PJS_AUTO_KEY(+)=PJH.PJS_AUTO_KEY
AND PJH.PJM_AUTO_KEY=63
AND PJS.STATUS_TYPE='O') AS contact_status,
  
    (SELECT MAX(  su.user_name) FROM  project_header pjh,
  project_status pjs,
  project_links pjl,
  SYS_USERS SU
WHERE pjh.cmp_auto_key=POH.CMP_AUTO_KEY
and PJL.KEY_VALUE= POD.POD_AUTO_KEY
AND PJH.PJH_AUTO_KEY(+)=PJL.PJH_AUTO_KEY
AND PJS.PJS_AUTO_KEY(+)=PJH.PJS_AUTO_KEY
and su.sysur_auto_key= pjh.sysur_auto_key
AND PJH.PJM_AUTO_KEY=63
AND PJS.STATUS_TYPE='O') AS user_name

  
FROM EXCHANGE EXC,
  PARTS_MASTER PNM,
  PO_DETAIL POD,
  PO_HEADER POH,
  COMPANIES CMP,
  SM_HEADER SMH, 
  SM_DETAIL SMD
  
WHERE 
PNM.PNM_AUTO_KEY   (+) = EXC.PNM_AUTO_KEY
AND POD.POD_AUTO_KEY    = EXC.POD_AUTO_KEY(+)
AND POH.POH_AUTO_KEY    = POD.POH_AUTO_KEY
AND CMP.CMP_AUTO_KEY    = POH.CMP_AUTO_KEY
AND SMD.POD_AUTO_KEY(+)=POD.POD_AUTO_KEY
AND SMH.SMH_AUTO_KEY(+)=SMD.SMH_AUTO_KEY
) WHERE CONTACT_NUMBER IS NOT NULL